<!DOCTYPE html>
<html lang="ko">


<head>
    <meta charset="UTF-8"/>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>고양이 가라사대</title>
</head>
<style>
    .main-card {
        width: 400px;
        margin: auto;
        background-color: black;
    }

    .favorite-card {
        margin: auto;
        padding-bottom: 20px;
        background-color: black;
    }

    .favorite-card div {
        min-height: 20px;
        max-height: 60px;
        width: 100%;
        overflow: hidden;
    }


    .main-card div {
        min-height: 30px;
        max-height: 60px;
        width: 100%;
        overflow: hidden;
    }


    body {
        text-align: center;
    }

    .main-card .card-msg {
        position: relative;
        -webkit-text-stroke: 1px black;
        color: white;
        font-weight: bold;
        font-size: 22px;
        text-shadow: 1px 1px 0 #000,
        1px -1px 0 #000,
        -1px 1px 0 #000,
        1px 1px 0 #000;
    }


    .main-card button {
        position: relative;
        right: -170px;
        bottom: 35px;
    }

    .favorites {
        list-style: none;
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 15px;
    }

    /*.favorites img {
      width: 150px;
    }*/
</style>
<script type="text/babel">
    const catList = [];

    const init = () => {
        makeCatImg();
    }

    const makeCatImg = () => {
        for (var i = 1; i <= 15; i++) {
            const index = i.toString().padStart(2, '0');
            const tmpImg = "https://offetuoso.github.io/images/etc/cat/cat-0" + index + ".png";
            catList.push(tmpImg);
        }
        shuffle(catList)
    }

    function shuffle(array) {
        for (let index = array.length - 1; index > 0; index--) {
            const randomPosition = Math.floor(Math.random() * (index + 1));
            const temporary = array[index];
            array[index] = array[randomPosition];
            array[randomPosition] = temporary;
        }
    }


    const jsonLocalStorage = {
        setItem: (key, value) => {
            localStorage.setItem(key, JSON.stringify(value));
        },
        getItem: (key) => {
            return JSON.parse(localStorage.getItem(key));
        },
    };

    function CatItem(props) {

        return (
            <li>

                <div className="favorite-card">
                    <div><span className="card-msg-"></span></div>
                    <img
                        src={props.img}
                        alt={props.title}
                        style={{width: '150px' /*, border: '1px solid red'*/}} //스타일 자체를 props로 넘기기 {} 새로운 객체로 묶어 보냄
                    />
                </div>
            </li>
        )
    }

    const Title = (props) => {
        console.log(props.children)
        return <h1>{props.children}</h1>
    }


    function Favorites({favorites}) {

        return (
            <ul className="favorites">
                {favorites.map(cat => <CatItem img={cat} title="CAT2" key={cat}/>)}
            </ul>
        )
    }


    const MainCard = ({img, value, onHeartClick}) => {
        return (
            <div id="main-card" className="main-card">
                <div>
                    <span className="card-msg">{value}</span>
                </div>
                <img
                    src={img}
                    alt="고양이"
                    width="400"
                />

                <button onClick={onHeartClick}>🤍</button>
            </div>
        )
    }

    const Form = ({value, onFormSubmit, onInputChange, errorMessage}) => {

        return (
            <form onSubmit={onFormSubmit}>
                <input type="text"
                       name="name"
                       placeholder="영어 대사를 입력해주세요"
                       value={value}
                       onChange={onInputChange}
                />
                <button type="submit">생성</button>
                <p style={{color: 'red'}}>{errorMessage}</p>
            </form>
        )
    }

    const App = () => {
        init();
        const CAT1 = catList[0];

        const [counter, setCounter] = React.useState(
            jsonLocalStorage.getItem("counter") || 0
        );

        const [mainCat, setMainCat] = React.useState(CAT1);

        const [favorites, setFavorites] = React.useState(
            jsonLocalStorage.getItem("favorites") || []
        );

        const [value, setValue] = React.useState('');
        const [errorMessage, setErrorMessage] = React.useState('');
        const includesHangul = (text) => /[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/i.test(text);

        function handleFormSubmit(e) {
            e.preventDefault();
            setErrorMessage("");

            if (value === '') {
                setErrorMessage("빈 값으로 만들 수 없습니다.");
                return false;
            }

            updateMainCat();

        }

        function handleInputChange(e) {
            const userValue = e.target.value;
            setErrorMessage("");
            /* if (includesHangul(e.target.value)) {
                 //alert("한글은 입력할 수 없습니다.");
                 setErrorMessage("한글은 입력할 수 없습니다.");
                 return false;
             }*/

            setValue(userValue.toUpperCase());
        }


        function updateMainCat() {
            const nextCounter = Number(counter) + 1;
            setMainCat(catList[nextCounter % 15]);
            setCounter(nextCounter)
            jsonLocalStorage.setItem("counter", nextCounter);
        }

        function downImg() {
            html2canvas($("#main-card")[0]).then(function (canvas) {
                var myImage = canvas.toDataURL();
                downloadURI(myImage, "저장할 파일명.png")
            });
        }

        function downloadURI(uri, name) {
            var link = document.createElement("a")
            link.download = name;
            link.href = uri;
            document.body.appendChild(link);
            link.click();
        }

        function handleHeartClick_back() {
            const nextFavorites = [...favorites, mainCat]
            setFavorites(nextFavorites);
            jsonLocalStorage.setItem("favorites", nextFavorites);

            console.log(value)
            /*
                        const nextScripts = [...scripts, value]
                        setScripts(nextScripts);
                        jsonLocalStorage.setItem("scripts", nextScripts);*/

            //updateMainCat();
            //downImg();
        }


        function handleHeartClick() {
            const nextFavorites = [...favorites, mainCat]
            setFavorites(nextFavorites);
            jsonLocalStorage.setItem("favorites", nextFavorites);
        }

        return (
            <div>
                <Title>{counter} 번째 고양이 가라사대</Title>
                <Form value={value} onFormSubmit={handleFormSubmit}
                      onInputChange={handleInputChange} errorMessage={errorMessage}/>
                <MainCard img={mainCat} value={value} title="CAT1" onHeartClick={handleHeartClick}/>
                <Favorites favorites={favorites}/>
            </div>
        )
    }


    const 여기다그려 = document.querySelector("#app");

    ReactDOM.render(<App/>, 여기다그려);

</script>

<script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="http://html2canvas.hertzen.com/dist/html2canvas.js"></script>
<script crossorigin="anonymous"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
        src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script type="text/javascript">
    function fnToggleButtonTranslatePage() {
        if (btnTranslatePage.style.display == "none") {
            localStorage.setItem("0k0aTranslatePage", "false");
            var oTrFrame = document.querySelector("body > div.skiptranslate");
            if (oTrFrame != undefined) oTrFrame.style.display = "none";
            btnTranslatePage.setAttribute("style", "color:black;display:block;");
        } else {
            localStorage.setItem("0k0aTranslatePage", "true");
            location.reload();
        }
    }

    function fnTryTranslatePage(iTryCnt) {
        var bTranslated = false;
        var oElement = document.querySelector("#google_translate_element select");
        if ((oElement != undefined) && (oElement.options != undefined) && (oElement.options.length != undefined) && (oElement.options.length > 0)) {
            var sNavLang = navigator.language.substr(0, 2);
            var eEvent = new Event("change");
            for (var i = 0; i < oElement.options.length; i++) {
                if (oElement.options[i].value == sNavLang) {
                    oElement.options[i].selected = true;
                    oElement.dispatchEvent(eEvent);
                    bTranslated = true;
                    break;
                }
            }
            if (bTranslated == false) {
                for (var i = 0; i < oElement.options.length; i++) {
                    if (oElement.options[i].value == "en") {
                        oElement.options[i].selected = true;
                        oElement.dispatchEvent(eEvent);
                        bTranslated = true;
                        break;
                    }
                }
            }
            var oTrFrame = document.querySelector("body > div.skiptranslate > iframe.goog-te-banner-frame");
            if (oTrFrame != undefined) {
                var oTrFrameClose = oTrFrame.contentDocument.querySelector("a.goog-close-link");
                if (oTrFrameClose != undefined) oTrFrameClose.addEventListener("click", fnToggleButtonTranslatePage);
            }
        }
        if ((bTranslated == false) && (iTryCnt < 32))
            setTimeout(fnTryTranslatePage, 500, iTryCnt + 1);
    }

    function fnGoogleTranslateElementInit() {
        new google.translate.TranslateElement({pageLanguage: 'ko'}, 'google_translate_element');
        fnTryTranslatePage(0);
    }

    if ((document.querySelector("#btnTranslatePage") != undefined) && (navigator.language.substr(0, 2) != "ko")) {
        var b0k0aTranslatePage = localStorage.getItem("0k0aTranslatePage");
        if ((b0k0aTranslatePage === null) || ((b0k0aTranslatePage !== null) && (b0k0aTranslatePage !== "false"))) {
            var oHead = document.getElementsByTagName('head')[0];
            var oAllScript = document.querySelectorAll('head script');
            for (var i = oAllScript.length - 1; i >= 0; i--) {
                if (oAllScript[i].src.indexOf("translate.google.com") > -1) oAllScript[i].parentNode.removeChild(oAllScript[i]);
            }
            var oScript = document.createElement('script');
            oScript.type = 'text/javascript';
            oScript.src = 'https://translate.google.com/translate_a/element.js?cb=fnGoogleTranslateElementInit';
            oHead.appendChild(oScript);
        } else btnTranslatePage.setAttribute("style", "color:black;display:block;");
    }
</script>

<body>
<div id="app">
</div>
</body>

</html>